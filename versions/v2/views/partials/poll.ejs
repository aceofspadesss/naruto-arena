<% if (locals.poll) { %>
    <div class="brspacer">
    <h4 class="block">Poll</h4>
    <% const totalVotes=poll.options.reduce((sum, opt)=> sum + opt.votes, 0);
        const showForm = locals.user && !locals.hasVoted;
        const pollSlug = poll.question.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
        %>
        <div class="marker">
            <a href="/<%= pollSlug %>"><b><%= poll.question %></b></a><br />
            <% if (showForm) { %>
                <form action="/poll/vote/<%= poll.id %>" method="POST">
            <% } %>

                <% poll.options.forEach((option, index)=> {
                    const percent = totalVotes > 0 ? Math.round((option.votes / totalVotes) * 100) : 0;
                    %>
                    <div style="margin-bottom: 5px;">
                        <% if (showForm) { %>
                            <input type="radio" name="optionIndex" value="<%= index %>" id="opt-<%= index %>"
                                style="vertical-align: middle;">
                            <label for="opt-<%= index %>">
                                <%= option.text %> (<%= option.votes %>) (<%= percent %>%)
                            </label>
                            <% } else { %>
                                <%= option.text %> (<%= option.votes %>) (<%= percent %>%)
                            <% } %>
                            <div class="pollbar" style="width:<%= percent %>%;"></div>
                    </div>
                    <% }); %>

                        <% if (showForm) { %>
                            <br>
                            <input type="submit" value="Vote" class="button"">
                </form>
                <% } %>

                    <img class="pre" src="/images/pres/prenav.gif"> Amount of votes: <span><%= totalVotes %></span><br />
                        <img class="pre" src="/images/pres/prenav.gif"> Poll created on: <span><%= new
                            Date(poll.createdAt).toLocaleDateString() %></span><br/>
                            <img class='pre' src='/images/pres/prenav.gif' /> <a href="/<%= pollSlug %>" class="polllinks">Comments: <%= locals.pollCommentCount || 0 %></a>
                            <% } %>
        </div>
    </div>